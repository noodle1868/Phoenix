<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<!-- 이 XML 을 어떤 interface 를 통해서 연결 할 건가? -->
<mapper namespace="com.silver.item.CarDAO">
	
	<!-- 차량목록 -->
	<select id="carList" resultType="car">
		select * from car
	</select>
	
	<select id="totalCountDriveHistory" resultType="int" parameterType="int">
		SELECT COUNT(chis_idx) FROM carhistory WHERE car_idx = #{carIdx}
	</select>
	
	<select id="getDriveHistory" resultType="car">
		SELECT * from carhistory WHERE car_idx = #{param1} 
			ORDER BY chis_date DESC LIMIT 3 OFFSET #{param2}
	</select>
	
	<select id="totalCountCarBookList" resultType="int" parameterType="int">
		SELECT COUNT(b.cb_idx) FROM book b
			INNER JOIN `member` m ON m.mem_id = b.mem_id
		WHERE car_idx = #{carIdx}
	</select>
	
	<select id="getCarBookList" resultType="car">
		SELECT b.cb_idx, b.b_start, b.b_end, m.mem_name, b.b_cancel FROM book b
			INNER JOIN `member` m ON m.mem_id = b.mem_id
		WHERE car_idx = #{param1} ORDER BY b.cb_idx DESC limit 5 offset #{param2}
	</select>
	
	<insert id="carHistoryResist" parameterType="hashmap">
		<choose>
			<when test="chisBigo != null and !chisBigo.equals('')">
				INSERT INTO carhistory(car_idx, chis_date, chis_driver, chis_place, chis_reason, chis_km, chis_liter, chis_bigo)
			VALUES(#{carIdx}, #{chisDate}, #{chisDriver}, #{chisPlace}, #{chisReason}, #{chisKm}, #{chisLiter}, #{chisBigo});
			</when>
			<otherwise>
				INSERT INTO carhistory(car_idx, chis_date, chis_driver, chis_place, chis_reason, chis_km, chis_liter)
			VALUES(#{carIdx}, #{chisDate}, #{chisDriver}, #{chisPlace}, #{chisReason}, #{chisKm}, #{chisLiter});
			</otherwise>
		</choose>
	</insert>
	
	<insert id="carResist" parameterType="hashmap">
		INSERT into car(it_idx, car_name, car_num, car_state, car_part, car_type, car_year)
			VALUES(5, #{carName}, #{carNum}, #{carState}, #{carPart}, #{carType}, #{carYear});
	</insert>
	
	<select id="getCarInfo" parameterType="int" resultType="car">
		select * from car where car_idx = #{carIdx}
	</select>
	
	<update id="carModify" parameterType="hashmap">
		UPDATE car 
			SET car_name=#{carName}, car_num=#{carNum}, car_state=#{carState}, car_part=#{carPart}, car_type=#{carType}, car_year=#{carYear}
		where car_idx=#{carIdx}
	</update>

</mapper>